<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MARKT∞ — Код, боты, анимации</title>
  <meta name="description" content="Маркетплейс цифровых услуг: код сайта, телеграм‑боты, анимации, исправление ошибок. Супер‑дизайн, плавные анимации и корзина с уникальным ID." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--ring:255 255 255 / .18;}
    html,body{height:100%;}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans',sans-serif;}
    /* Animated gradient background */
    .bg-aurora{
      background: radial-gradient(60% 100% at 20% 0%, rgba(99,102,241,.35) 0%, rgba(99,102,241,0) 55%),
                  radial-gradient(60% 100% at 80% 20%, rgba(56,189,248,.35) 0%, rgba(56,189,248,0) 55%),
                  radial-gradient(50% 100% at 50% 100%, rgba(236,72,153,.35) 0%, rgba(236,72,153,0) 60%),
                  linear-gradient(180deg, #0b1220 0%, #0a0f1a 100%);
      animation: shift 18s ease-in-out infinite alternate;
      background-size: 140% 140%;
    }
    @keyframes shift{0%{background-position:0% 0%} 100%{background-position:100% 100%}}
    /* Glass card */
    .glass{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));box-shadow:0 1px 0 rgba(255,255,255,.05) inset, 0 10px 40px rgba(0,0,0,.25);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);}
    /* Reveal */
    .reveal{opacity:0; transform:translateY(16px); transition:all .7s cubic-bezier(.2,.8,.2,1)}
    .reveal.in{opacity:1; transform:none}
    /* Floating badge glow */
    .glow{box-shadow:0 0 0 2px rgba(255,255,255,.06), 0 0 30px rgba(56,189,248,.3)}
    /* Pretty scrollbars */
    ::-webkit-scrollbar{height:10px;width:10px}
    ::-webkit-scrollbar-track{background:rgba(255,255,255,.04)}
    ::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(99,102,241,.7),rgba(56,189,248,.7));border-radius:999px}
    /* Button press ripple */
    .ripple{position:relative;overflow:hidden}
    .ripple:after{content:"";position:absolute;border-radius:999px;inset:auto auto 50% 50%;width:10px;height:10px;background:rgba(255,255,255,.5);transform:translate(-50%,-50%) scale(0);opacity:0;}
    .ripple:active:after{animation:rip .6s ease-out}
    @keyframes rip{0%{transform:translate(-50%,-50%) scale(0);opacity:.7}100%{transform:translate(-50%,-50%) scale(16);opacity:0}}
  </style>
</head>
<body class="bg-aurora text-white selection:bg-fuchsia-500/60 selection:text-white">
  <!-- HEADER -->
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/5 border-b border-white/10">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-3 flex items-center gap-4">
      <a href="#" class="flex items-center gap-2 group">
        <span class="grid place-items-center w-9 h-9 rounded-2xl bg-gradient-to-tr from-indigo-500 via-sky-400 to-fuchsia-500 shadow-lg shadow-sky-500/20">
          <!-- infinity icon -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M3 12c2.5-4 6-4 9 0s6.5 4 9 0"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M3 12c2.5 4 6 4 9 0s6.5-4 9 0"/></svg>
        </span>
        <span class="text-lg font-black tracking-tight">MARKT∞</span>
      </a>
      <nav class="ml-auto hidden sm:flex items-center gap-6 text-sm text-white/80">
        <a href="#catalog" class="hover:text-white">Каталог</a>
        <a href="#how" class="hover:text-white">Как это работает</a>
        <a href="#contact" class="hover:text-white">Контакты</a>
        <button id="cartBtn" class="relative inline-flex items-center gap-2 rounded-xl bg-white/10 hover:bg-white/15 transition px-3 py-1.5 ripple">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M3 3h2l.5 2M7 13h10l3-7H6.5M7 13l-1.5-8M7 13l-2 9m12-9l-2 9M9 22a1 1 0 100-2 1 1 0 000 2zm8 0a1 1 0 100-2 1 1 0 000 2z"/></svg>
          <span>Корзина</span>
          <span id="cartCount" class="absolute -top-2 -right-2 text-xs bg-sky-500 text-white px-1.5 py-0.5 rounded-full glow">0</span>
        </button>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="relative overflow-hidden">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-16 pb-12">
      <div class="grid lg:grid-cols-2 gap-10 items-center">
        <div class="reveal">
          <h1 class="text-4xl sm:text-6xl font-black leading-tight">
            Самый <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-sky-300 to-fuchsia-400">крутой</span> маркетплейс цифровых услуг
          </h1>
          <p class="mt-4 text-white/80 max-w-xl">Собирайте в корзину: код сайта, Telegram‑ботов, анимации, исправление ошибок и многое другое. Каждая корзина получает <span class="font-semibold">уникальный ID</span> вида <code class="px-1.5 py-0.5 rounded bg-white/10">00001</code> — просто укажите его в письме, и мы всё найдём.</p>
          <div class="mt-8 flex flex-wrap items-center gap-3">
            <a href="#catalog" class="rounded-2xl bg-gradient-to-r from-indigo-500 to-sky-400 hover:from-indigo-400 hover:to-sky-300 px-5 py-3 font-semibold shadow-lg shadow-indigo-700/30 ripple">В каталог</a>
            <button id="showCartTop" class="rounded-2xl bg-white/10 hover:bg-white/15 px-5 py-3 font-semibold ripple">Открыть корзину</button>
          </div>
          <div id="cartIdBadge" class="mt-6 inline-flex items-center gap-2 glass px-3 py-1.5 rounded-xl text-sm">
            <span class="opacity-70">ID вашей корзины:</span>
            <span class="font-mono tracking-widest text-sky-300 font-bold" id="cartIdText">00000</span>
          </div>
        </div>
        <div class="relative h-72 sm:h-96 lg:h-[28rem] reveal">
          <!-- Decorative 3D-ish cards -->
          <div class="absolute inset-0 grid place-items-center">
            <div class="relative w-full max-w-md">
              <div class="absolute -top-6 -left-8 rotate-[-6deg] glass rounded-3xl p-5 border border-white/10 backdrop-blur-lg">
                <div class="text-xs text-white/70">Пакет</div>
                <div class="text-lg font-bold">Telegram‑бот + Оплата</div>
                <div class="mt-2 text-white/70">От 499€ • 7–10 дней</div>
              </div>
              <div class="absolute top-24 -right-10 rotate-[5deg] glass rounded-3xl p-5 border border-white/10">
                <div class="text-xs text-white/70">Услуга</div>
                <div class="text-lg font-bold">Анимации для сайта</div>
                <div class="mt-2 text-white/70">GSAP/Lottie • Motion UI</div>
              </div>
              <div class="absolute bottom-6 left-8 rotate-[1deg] glass rounded-3xl p-5 border border-white/10">
                <div class="text-xs text-white/70">Запрос</div>
                <div class="text-lg font-bold">Исправление ошибок</div>
                <div class="mt-2 text-white/70">React / Python / Node</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CATALOG -->
  <section id="catalog" class="py-12">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col sm:flex-row sm:items-end gap-4 sm:gap-6 mb-6">
        <div>
          <h2 class="text-2xl sm:text-3xl font-extrabold">Каталог услуг</h2>
          <p class="text-white/70">Добавляйте позиции, формируйте корзину и оформляйте заказ письмом или через GitHub.</p>
        </div>
        <div class="ml-auto flex items-center gap-3 w-full sm:w-auto">
          <input id="search" type="search" placeholder="Поиск по каталогу…" class="w-full sm:w-72 bg-white/10 placeholder-white/50 border border-white/10 focus:border-sky-400/60 rounded-xl px-3 py-2 outline-none"/>
          <select id="categoryFilter" class="bg-white/10 border border-white/10 focus:border-sky-400/60 rounded-xl px-3 py-2 outline-none">
            <option value="all">Все категории</option>
          </select>
        </div>
      </div>

      <div id="grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
    </div>
  </section>

  <!-- HOW IT WORKS -->
  <section id="how" class="py-12">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="glass rounded-2xl p-6 border border-white/10 reveal">
          <div class="text-sm uppercase tracking-wide text-white/60">Шаг 1</div>
          <div class="text-xl font-bold mt-1">Соберите корзину</div>
          <p class="text-white/70 mt-2">Выберите услуги из каталога, задайте количество. Корзина автоматически сохраняется в этом браузере.</p>
        </div>
        <div class="glass rounded-2xl p-6 border border-white/10 reveal">
          <div class="text-sm uppercase tracking-wide text-white/60">Шаг 2</div>
          <div class="text-xl font-bold mt-1">Получите ID</div>
          <p class="text-white/70 mt-2">Каждая корзина получает номер формата 00001. Его видно в шапке и в окне оформления.</p>
        </div>
        <div class="glass rounded-2xl p-6 border border-white/10 reveal">
          <div class="text-sm uppercase tracking-wide text-white/60">Шаг 3</div>
          <div class="text-xl font-bold mt-1">Отправьте заказ</div>
          <p class="text-white/70 mt-2">Нажмите «Письмо продавцу» или «Через GitHub». В сообщении уже будет ID корзины и детали заказа.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="glass rounded-3xl p-8 border border-white/10 grid md:grid-cols-2 gap-6 items-center reveal">
        <div>
          <h3 class="text-2xl font-extrabold">Свяжитесь с нами</h3>
          <p class="text-white/70 mt-2">Самый быстрый способ — GitHub. Откройте issue в репозитории и вставьте ID корзины.</p>
          <div class="mt-4 flex items-center gap-3">
            <a id="githubProfile" target="_blank" rel="noopener" class="inline-flex items-center gap-2 rounded-xl bg-white/10 hover:bg-white/15 px-4 py-2 ripple" href="https://github.com/programmerpythona/adminstate.github.io">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.014c0 4.43 2.865 8.185 6.839 9.504.5.093.682-.217.682-.483 0-.237-.009-.866-.014-1.7-2.782.605-3.369-1.342-3.369-1.342-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.607.069-.607 1.004.07 1.532 1.032 1.532 1.032.892 1.53 2.341 1.088 2.91.833.091-.647.35-1.088.636-1.338-2.221-.253-4.555-1.112-4.555-4.948 0-1.092.39-1.987 1.03-2.688-.104-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0 1 12 6.844c.85.004 1.705.115 2.504.338 1.909-1.296 2.748-1.026 2.748-1.026.546 1.378.204 2.397.1 2.65.64.7 1.028 1.596 1.028 2.688 0 3.845-2.337 4.692-4.565 4.94.359.31.679.923.679 1.86 0 1.343-.012 2.427-.012 2.757 0 .268.18.58.688.482A10.02 10.02 0 0 0 22 12.014C22 6.484 17.523 2 12 2Z" clip-rule="evenodd"/></svg>
              <span>GitHub: adminstate.github.io</span>
            </a>
          </div>
        </div>
        <div class="text-sm text-white/70">
          <div class="mb-3">E‑mail для заказов можно указать в коде (переменная <code class="px-1 rounded bg-white/10">SELLER_EMAIL</code>). Кнопка «Письмо продавцу» сформирует письмо с деталями.</div>
          <div class="mb-3">Для абсолютной уникальности ID между всеми пользователями подключите серверless‑хранилище (Cloudflare Worker/Telegram/Google Sheets). В этой версии ID считается локально и сохраняется в браузере.</div>
          <div>Развёртывание: положите этот файл как <code class="px-1 rounded bg-white/10">index.html</code> в репозиторий GitHub Pages, и всё готово.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- CART DRAWER -->
  <aside id="cartDrawer" class="fixed top-0 right-0 h-screen w-full max-w-md translate-x-full transition-transform duration-300 z-50">
    <div class="h-full flex flex-col bg-[#0b1220]/95 backdrop-blur-2xl border-l border-white/10">
      <div class="p-4 flex items-center gap-3 border-b border-white/10">
        <button id="closeCart" class="p-2 rounded-lg hover:bg-white/10">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M6 18 18 6M6 6l12 12"/></svg>
        </button>
        <div class="text-xl font-bold">Корзина</div>
        <div class="ml-auto text-sm opacity-80">ID: <span id="cartIdText2" class="font-mono">00000</span></div>
      </div>
      <div class="p-4 overflow-auto grow" id="cartItems"></div>
      <div class="p-4 border-t border-white/10 space-y-3">
        <div class="flex justify-between text-white/80 text-sm"><span>Промежуточный итог</span><span id="subtotal">0€</span></div>
        <div class="flex justify-between text-white/80 text-sm"><span>Скидка</span><span id="discount">0€</span></div>
        <div class="flex justify-between text-lg font-extrabold"><span>Итого</span><span id="grandTotal">0€</span></div>
        <div class="grid grid-cols-2 gap-2 pt-1">
          <button id="toEmail" class="rounded-xl bg-gradient-to-r from-indigo-500 to-sky-400 hover:from-indigo-400 hover:to-sky-300 px-4 py-2 font-semibold ripple">Письмо продавцу</button>
          <a id="toGithub" target="_blank" class="rounded-xl bg-white/10 hover:bg-white/15 px-4 py-2 font-semibold text-center ripple">Через GitHub</a>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button id="copyOrder" class="rounded-xl bg-white/10 hover:bg-white/15 px-4 py-2 font-medium ripple">Скопировать заказ</button>
          <button id="newCart" class="rounded-xl bg-white/10 hover:bg-white/15 px-4 py-2 font-medium ripple">Новая корзина</button>
        </div>
      </div>
    </div>
  </aside>

  <!-- TOAST -->
  <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 z-[60] opacity-0 pointer-events-none transition">
    <div class="glass border border-white/10 px-4 py-2 rounded-xl text-sm">Скопировано в буфер обмена</div>
  </div>

  <script>
    // ======== CONFIG ========
    const SELLER_EMAIL = ""; // ←← УКАЖИТЕ E‑MAIL ПРОДАВЦА (например: "orders@example.com"). Если пусто — кнопка письма предупредит об ошибке.
    const GITHUB_OWNER = "programmerpythona"; // ← ваш GitHub user/org
    const GITHUB_REPO  = "adminstate.github.io"; // ← ваш репозиторий для Issues

    // ======== DATA ========
    const CATEGORIES = [
      { id: 'site',   name: 'Код сайта' },
      { id: 'bot',    name: 'Telegram‑боты' },
      { id: 'fx',     name: 'Анимации & Motion' },
      { id: 'fix',    name: 'Исправление ошибок' },
      { id: 'extra',  name: 'Доп. услуги' },
    ];

    const PRODUCTS = [
      { id:'site-landing', cat:'site', name:'Готовый лендинг (Next.js/Vite)', price:699, unit:'€', desc:'Адаптивный, SEO‑оптимизированный, подключение форм и аналитики.', tags:['Next.js','Tailwind','SEO'] },
      { id:'site-shop', cat:'site', name:'Мини‑магазин (без бэкенда)', price:549, unit:'€', desc:'Статический магазин с корзиной, оплатой через виджет/ссылку.', tags:['Static','Stripe link'] },
      { id:'bot-basic', cat:'bot', name:'Telegram‑бот: базовый', price:499, unit:'€', desc:'Команды, меню, простая логика. Развёртывание + инструкции.', tags:['Python','aiogram'] },
      { id:'bot-pay', cat:'bot', name:'Telegram‑бот: оплата', price:799, unit:'€', desc:'Приём платежей, статусы заказов, админ‑панель в ТГ.', tags:['Payments','Webhook'] },
      { id:'fx-hero', cat:'fx', name:'Анимации: hero‑сцена', price:240, unit:'€', desc:'Градиенты, параллакс, плавные появления, микро‑эффекты.', tags:['GSAP‑style','Parallax'] },
      { id:'fx-lottie', cat:'fx', name:'Интеграция Lottie', price:180, unit:'€', desc:'Импорт и управление Lottie анимациями.', tags:['Lottie'] },
      { id:'fix-bugs', cat:'fix', name:'Исправление ошибок в коде', price:60, unit:'€/час', desc:'Багфикс, hot‑fix, код‑ревью с рекомендациями.', tags:['Bugfix','Review'] },
      { id:'fix-refactor', cat:'fix', name:'Рефакторинг + ускорение', price:380, unit:'€', desc:'Профилирование, оптимизации, снижение TTI/LCP.', tags:['Perf','Refactor'] },
      { id:'extra-design', cat:'extra', name:'UI‑комплект (дизайн-система)', price:420, unit:'€', desc:'Набор компонентов, гайды по отступам, типографике.', tags:['UI Kit'] },
      { id:'extra-cms', cat:'extra', name:'Интеграция CMS/Headless', price:460, unit:'€', desc:'Подключение контент‑панели (Sanity/Contentful).', tags:['CMS'] },
    ];

    // ======== STATE & STORAGE ========
    const lastIdKey = 'mkp_last_id_seq';
    const currentIdKey = 'mkp_current_cart_id';
    let cartId = loadOrCreateCartId();

    function loadOrCreateCartId(){
      let id = localStorage.getItem(currentIdKey);
      if(!id){ id = nextId(); localStorage.setItem(currentIdKey, id); }
      return id;
    }
    function nextId(){
      let n = parseInt(localStorage.getItem(lastIdKey) || '0', 10) + 1;
      localStorage.setItem(lastIdKey, String(n));
      return String(n).padStart(5,'0');
    }

    function cartStorageKey(){ return `mkp_cart_${cartId}`; }

    function loadCart(){
      try{ return JSON.parse(localStorage.getItem(cartStorageKey()) || '{}'); }
      catch{ return {}; }
    }
    function saveCart(cart){ localStorage.setItem(cartStorageKey(), JSON.stringify(cart)); updateBadges(); }

    let CART = loadCart(); // { [productId]: qty }

    // ======== UTIL ========
    const fmt = (n) => new Intl.NumberFormat('ru-RU', { style:'currency', currency:'EUR', maximumFractionDigits:0 }).format(n);
    const byId = (id) => document.getElementById(id);

    function updateBadges(){
      const count = Object.values(CART).reduce((a,b)=>a+b,0);
      byId('cartCount').textContent = count;
      byId('cartIdText').textContent = cartId;
      byId('cartIdText2').textContent = cartId;
      // Update totals
      const subtotal = Object.entries(CART).reduce((sum,[pid,qty])=>{
        const p = PRODUCTS.find(x=>x.id===pid); if(!p) return sum; const base = (p.unit==='€/час') ? p.price*qty : p.price*qty; return sum + base;
      },0);
      byId('subtotal').textContent = fmt(subtotal);
      const discount = 0; // hook for future promos
      byId('discount').textContent = fmt(discount);
      byId('grandTotal').textContent = fmt(subtotal - discount);
      // Update GitHub link
      byId('toGithub').href = buildGithubIssueURL();
    }

    function buildOrderLines(){
      const lines = [
        `Заказ MARKT∞ — Корзина #${cartId}`,
        `Дата: ${new Date().toLocaleString('ru-RU')}`,
        '',
      ];
      let i = 1, total = 0;
      for(const [pid, qty] of Object.entries(CART)){
        const p = PRODUCTS.find(x=>x.id===pid); if(!p) continue;
        const priceInfo = p.unit==='€/час' ? `${p.price} €/час` : `${p.price} €`;
        const rowTotal = (p.unit==='€/час') ? p.price*qty : p.price*qty;
        total += rowTotal;
        lines.push(`${i}. ${p.name} — ${qty} × ${priceInfo} = ${rowTotal} €`);
        i++;
      }
      lines.push('', `Итого: ${total} €`, '', 'Пожалуйста, укажите этот ID в переписке, чтобы мы быстро нашли ваш заказ.');
      return { text: lines.join('\n'), total };
    }

    function buildMailto(){
      const { text } = buildOrderLines();
      const subject = `Заказ MARKT∞ — Корзина #${cartId}`;
      return `mailto:${encodeURIComponent(SELLER_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(text)}`;
    }

    function buildGithubIssueURL(){
      const { text } = buildOrderLines();
      const title = `Order #${cartId} — MARKT∞`;
      return `https://github.com/${encodeURIComponent(GITHUB_OWNER)}/${encodeURIComponent(GITHUB_REPO)}/issues/new?title=${encodeURIComponent(title)}&body=${encodeURIComponent(text)}`;
    }

    function toast(){
      const t = byId('toast'); t.style.opacity = '1'; t.style.pointerEvents = 'auto';
      setTimeout(()=>{ t.style.opacity='0'; t.style.pointerEvents='none'; }, 1600);
    }

    // ======== RENDER CATALOG ========
    const grid = byId('grid');
    const search = byId('search');
    const categoryFilter = byId('categoryFilter');

    function renderCategoryOptions(){
      for(const c of CATEGORIES){
        const opt = document.createElement('option');
        opt.value = c.id; opt.textContent = c.name; categoryFilter.appendChild(opt);
      }
    }

    function card(product){
      const { id, name, price, unit, desc, tags, cat } = product;
      const wrapper = document.createElement('div');
      wrapper.className = 'glass rounded-2xl border border-white/10 p-5 reveal';
      wrapper.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-indigo-500 to-sky-400 grid place-items-center shadow-lg shadow-indigo-700/30">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M4 7a2 2 0 012-2h6l6 6v7a2 2 0 01-2 2H6a2 2 0 01-2-2V7z"/></svg>
          </div>
          <div class="min-w-0 grow">
            <div class="flex items-center gap-2">
              <h3 class="font-bold text-lg leading-tight">${name}</h3>
              <span class="text-xs text-white/60 px-2 py-0.5 rounded-full bg-white/5 border border-white/10">${CATEGORIES.find(x=>x.id===cat)?.name||''}</span>
            </div>
            <p class="text-white/70 mt-1">${desc}</p>
            <div class="flex flex-wrap gap-1.5 mt-2">${tags.map(t=>`<span class='text-xs text-white/70 px-2 py-0.5 rounded-full bg-white/5 border border-white/10'>${t}</span>`).join('')}</div>
            <div class="mt-4 flex items-center justify-between">
              <div class="text-xl font-extrabold">${unit==='€/час' ? price + ' ' + unit : price + ' €'}</div>
              <button data-add="${id}" class="addBtn rounded-xl bg-white/10 hover:bg-white/15 px-4 py-2 font-semibold ripple">В корзину</button>
            </div>
          </div>
        </div>`;
      return wrapper;
    }

    function renderGrid(){
      grid.innerHTML = '';
      const q = (search.value||'').trim().toLowerCase();
      const cat = categoryFilter.value;
      const list = PRODUCTS.filter(p=>{
        const okCat = (cat==='all' || p.cat===cat);
        const okQ = !q || [p.name,p.desc,...p.tags].join(' ').toLowerCase().includes(q);
        return okCat && okQ;
      });
      for(const p of list){ grid.appendChild(card(p)); }
      // attach listeners
      grid.querySelectorAll('[data-add]').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const pid = btn.getAttribute('data-add');
          CART[pid] = (CART[pid]||0) + 1;
          saveCart(CART);
          btn.animate([{transform:'scale(1)'},{transform:'scale(.95)'},{transform:'scale(1)'}],{duration:220});
        });
      });
      revealNow();
      renderCartItems();
    }

    // ======== CART RENDER ========
    const cartItemsEl = byId('cartItems');

    function renderCartItems(){
      const entries = Object.entries(CART);
      if(entries.length===0){
        cartItemsEl.innerHTML = `<div class="text-white/60 text-sm">Корзина пуста. Добавьте что‑нибудь из каталога.</div>`;
      } else {
        cartItemsEl.innerHTML = entries.map(([pid,qty])=>{
          const p = PRODUCTS.find(x=>x.id===pid); if(!p) return '';
          const unitPrice = p.unit==='€/час' ? `${p.price} €/час` : `${p.price} €`;
          return `
          <div class="flex items-start gap-3 py-3 border-b border-white/10">
            <div class="w-10 h-10 rounded-xl bg-white/5 grid place-items-center">🧩</div>
            <div class="min-w-0 grow">
              <div class="font-semibold leading-tight">${p.name}</div>
              <div class="text-white/60 text-sm">${unitPrice}</div>
              <div class="mt-2 flex items-center gap-2">
                <button class="qtyBtn rounded-lg bg-white/10 hover:bg-white/15 px-2" data-dec="${pid}">−</button>
                <span class="min-w-[2ch] text-center">${qty}</span>
                <button class="qtyBtn rounded-lg bg-white/10 hover:bg-white/15 px-2" data-inc="${pid}">+</button>
                <button class="ml-3 text-white/60 hover:text-white text-sm" data-del="${pid}">Удалить</button>
              </div>
            </div>
            <div class="font-semibold">${p.unit==='€/час' ? (p.price*qty)+' €' : (p.price*qty)+' €'}</div>
          </div>`;
        }).join('');
      }
      // attach controls
      cartItemsEl.querySelectorAll('[data-dec]').forEach(btn=>btn.addEventListener('click',()=>{
        const id = btn.getAttribute('data-dec');
        CART[id] = Math.max(0,(CART[id]||0)-1); if(CART[id]===0) delete CART[id]; saveCart(CART); renderCartItems();
      }));
      cartItemsEl.querySelectorAll('[data-inc]').forEach(btn=>btn.addEventListener('click',()=>{
        const id = btn.getAttribute('data-inc'); CART[id] = (CART[id]||0)+1; saveCart(CART); renderCartItems();
      }));
      cartItemsEl.querySelectorAll('[data-del]').forEach(btn=>btn.addEventListener('click',()=>{
        const id = btn.getAttribute('data-del'); delete CART[id]; saveCart(CART); renderCartItems();
      }));
      updateBadges();
    }

    // ======== REVEAL ON SCROLL ========
    const io = new IntersectionObserver((entries)=>{
      for(const e of entries){ if(e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target);} }
    },{threshold:.14});
    function revealNow(){ document.querySelectorAll('.reveal').forEach(el=> io.observe(el)); }

    // ======== DRAWER TOGGLE ========
    const drawer = byId('cartDrawer');
    function openCart(){ drawer.style.transform = 'translateX(0)'; }
    function closeCart(){ drawer.style.transform = 'translateX(100%)'; }

    byId('cartBtn').addEventListener('click', openCart);
    byId('showCartTop').addEventListener('click', openCart);
    byId('closeCart').addEventListener('click', closeCart);

    // ======== ACTION BUTTONS ========
    byId('toEmail').addEventListener('click', ()=>{
      if(!SELLER_EMAIL){ alert('E‑mail продавца не указан. Откройте код и задайте SELLER_EMAIL.'); return; }
      window.location.href = buildMailto();
    });

    byId('toGithub').addEventListener('click', (e)=>{
      // link already set via updateBadges(); keep here if we want extra checks
      if(Object.keys(CART).length===0){ e.preventDefault(); alert('Корзина пуста. Добавьте хотя бы один товар.'); }
    });

    byId('copyOrder').addEventListener('click', async ()=>{
      const { text } = buildOrderLines();
      try{ await navigator.clipboard.writeText(text); toast(); }
      catch{ alert('Не удалось скопировать.'); }
    });

    byId('newCart').addEventListener('click', ()=>{
      // create new cart id, empty cart
      cartId = nextId();
      localStorage.setItem(currentIdKey, cartId);
      CART = {}; saveCart(CART); renderCartItems(); updateBadges();
    });

    // ======== INIT ========
    renderCategoryOptions();
    renderGrid();
    search.addEventListener('input', renderGrid);
    categoryFilter.addEventListener('change', renderGrid);
    updateBadges();
    revealNow();
  </script>
</body>
</html>
